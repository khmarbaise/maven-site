<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-04-05 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150405" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Maven &#x2013; Maven classloading</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.1.min.js"></script>

                          
        
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
                      
        
<script type="text/javascript">_uacct = "UA-140879-1";
        urchinTracker();</script>
          
                  </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="http://www.apache.org/" id="bannerLeft">
                                                                                                <img src="../images/apache-maven-project.png" />
                </a>
                      </div>
        <div class="pull-right">                                <a href=".././" id="bannerRight">
                                                                                                <img src="../images/maventxt_logo_200.gif" />
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="http://www.apache.org/" class="externalLink" title="Apache">
        Apache</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="../index.html" title="Maven">
        Maven</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">Maven classloading</li>
        
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 2015-04-05</li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Main</li>
                              
      <li>
  
                          <a href="../index.html" title="Welcome">
          <i class="none"></i>
        Welcome</a>
            </li>
                              <li class="nav-header">Get Maven</li>
                              
      <li>
  
                          <a href="../download.html" title="Download">
          <i class="none"></i>
        Download</a>
            </li>
                
      <li>
  
                          <a href="../docs/history.html" title="Releases History">
          <i class="none"></i>
        Releases History</a>
            </li>
                
      <li>
  
                          <a href="../docs/3.3.1/release-notes.html" title="Release Notes (3.3.1)">
          <i class="none"></i>
        Release Notes (3.3.1)</a>
            </li>
                
      <li>
  
                          <a href="../docs/3.2.5/release-notes.html" title="Release Notes (3.2.5)">
          <i class="none"></i>
        Release Notes (3.2.5)</a>
            </li>
                
      <li>
  
                          <a href="../docs/3.1.1/release-notes.html" title="Release Notes (3.1.1)">
          <i class="none"></i>
        Release Notes (3.1.1)</a>
            </li>
                
      <li>
  
                          <a href="../docs/3.0.5/release-notes.html" title="Release Notes (3.0.5)">
          <i class="none"></i>
        Release Notes (3.0.5)</a>
            </li>
                
      <li>
  
                          <a href="../release-notes-all.html" title="All Release Notes">
          <i class="none"></i>
        All Release Notes</a>
            </li>
                
      <li>
  
                          <a href="http://www.apache.org/licenses/" class="externalLink" title="License">
          <i class="none"></i>
        License</a>
            </li>
                
      <li>
  
                          <a href="../security.html" title="Security">
          <i class="none"></i>
        Security</a>
            </li>
                              <li class="nav-header">IDE Integration</li>
                              
      <li>
  
                          <a href="../eclipse-plugin.html" title="Eclipse">
          <i class="none"></i>
        Eclipse</a>
            </li>
                
      <li>
  
                          <a href="../netbeans-module.html" title="NetBeans">
          <i class="none"></i>
        NetBeans</a>
            </li>
                              <li class="nav-header">About Maven</li>
                              
      <li>
  
                          <a href="../what-is-maven.html" title="What is Maven?">
          <i class="none"></i>
        What is Maven?</a>
            </li>
                
      <li>
  
                          <a href="../maven-features.html" title="Features">
          <i class="none"></i>
        Features</a>
            </li>
                
      <li>
  
                          <a href="../general.html" title="FAQ (official)">
          <i class="none"></i>
        FAQ (official)</a>
            </li>
                
      <li>
  
                          <a href="http://docs.codehaus.org/display/MAVENUSER/FAQs-1" class="externalLink" title="FAQ (unofficial)">
          <i class="none"></i>
        FAQ (unofficial)</a>
            </li>
                
      <li>
  
                          <a href="../support-and-training.html" title="Support and Training">
          <i class="none"></i>
        Support and Training</a>
            </li>
                              <li class="nav-header">Documentation</li>
                              
      <li>
  
                          <a href="../plugins/index.html" title="Maven Plugins">
          <i class="none"></i>
        Maven Plugins</a>
            </li>
                
      <li>
  
                          <a href="../guides/index.html" title="Index (category)">
          <i class="none"></i>
        Index (category)</a>
            </li>
                
      <li>
  
                          <a href="../run-maven/index.html" title="Running Maven">
          <i class="none"></i>
        Running Maven</a>
            </li>
                                                                                                                                          
      <li>
  
                          <a href="../users/index.html" title="User Centre">
          <i class="icon-chevron-right"></i>
        User Centre</a>
                  </li>
                                                                                                      
      <li>
  
                          <a href="../plugin-developers/index.html" title="Plugin Developer Centre">
          <i class="icon-chevron-right"></i>
        Plugin Developer Centre</a>
                  </li>
                
      <li>
  
                          <a href="../repository/index.html" title="Maven Repository Centre">
          <i class="none"></i>
        Maven Repository Centre</a>
            </li>
                
      <li>
  
                          <a href="../developers/index.html" title="Maven Developer Centre">
          <i class="none"></i>
        Maven Developer Centre</a>
            </li>
                
      <li>
  
                          <a href="../articles.html" title="Books and Resources">
          <i class="none"></i>
        Books and Resources</a>
            </li>
                
      <li>
  
                          <a href="http://docs.codehaus.org/display/MAVENUSER/Home" class="externalLink" title="Wiki">
          <i class="none"></i>
        Wiki</a>
            </li>
                              <li class="nav-header">Community</li>
                              
      <li>
  
                          <a href="../community.html" title="Community Overview">
          <i class="none"></i>
        Community Overview</a>
            </li>
                
      <li>
  
                          <a href="../guides/development/guide-helping.html" title="How to Contribute">
          <i class="none"></i>
        How to Contribute</a>
            </li>
                
      <li>
  
                          <a href="../guides/mini/guide-maven-evangelism.html" title="Maven Repository">
          <i class="none"></i>
        Maven Repository</a>
            </li>
                
      <li>
  
                          <a href="../users/getting-help.html" title="Getting Help">
          <i class="none"></i>
        Getting Help</a>
            </li>
                
      <li>
  
                          <a href="../issue-tracking.html" title="Issue Tracking">
          <i class="none"></i>
        Issue Tracking</a>
            </li>
                
      <li>
  
                          <a href="../source-repository.html" title="Source Repository">
          <i class="none"></i>
        Source Repository</a>
            </li>
                
      <li>
  
                          <a href="../team-list.html" title="The Maven Team">
          <i class="none"></i>
        The Maven Team</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                          
      <li>
  
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                              <li class="nav-header">Maven Projects</li>
                              
      <li>
  
                          <a href="../ant-tasks/index.html" title="Ant Tasks">
          <i class="none"></i>
        Ant Tasks</a>
            </li>
                
      <li>
  
                          <a href="../archetype/index.html" title="Archetype">
          <i class="none"></i>
        Archetype</a>
            </li>
                
      <li>
  
                          <a href="../doxia/index.html" title="Doxia">
          <i class="none"></i>
        Doxia</a>
            </li>
                
      <li>
  
                          <a href="../jxr/index.html" title="JXR">
          <i class="none"></i>
        JXR</a>
            </li>
                
      <li>
  
                          <a href="../ref/current" title="Maven">
          <i class="none"></i>
        Maven</a>
            </li>
                
      <li>
  
                          <a href="../pom/index.html" title="Parent POMs">
          <i class="none"></i>
        Parent POMs</a>
            </li>
                
      <li>
  
                          <a href="../plugins/index.html" title="Plugins">
          <i class="none"></i>
        Plugins</a>
            </li>
                
      <li>
  
                          <a href="../plugin-testing/index.html" title="Plugin Testing">
          <i class="none"></i>
        Plugin Testing</a>
            </li>
                
      <li>
  
                          <a href="../plugin-tools/index.html" title="Plugin Tools">
          <i class="none"></i>
        Plugin Tools</a>
            </li>
                
      <li>
  
                          <a href="../apache-resource-bundles/index.html" title="Resource Bundles">
          <i class="none"></i>
        Resource Bundles</a>
            </li>
                
      <li>
  
                          <a href="../scm/index.html" title="SCM">
          <i class="none"></i>
        SCM</a>
            </li>
                
      <li>
  
                          <a href="../shared/index.html" title="Shared Components">
          <i class="none"></i>
        Shared Components</a>
            </li>
                
      <li>
  
                          <a href="../skins/index.html" title="Skins">
          <i class="none"></i>
        Skins</a>
            </li>
                
      <li>
  
                          <a href="../surefire/index.html" title="Surefire">
          <i class="none"></i>
        Surefire</a>
            </li>
                
      <li>
  
                          <a href="../wagon/index.html" title="Wagon">
          <i class="none"></i>
        Wagon</a>
            </li>
                              <li class="nav-header">ASF</li>
                              
      <li>
  
                          <a href="http://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How Apache Works">
          <i class="none"></i>
        How Apache Works</a>
            </li>
                
      <li>
  
                          <a href="http://www.apache.org/foundation/" class="externalLink" title="Foundation">
          <i class="none"></i>
        Foundation</a>
            </li>
                
      <li>
  
                          <a href="http://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsoring Apache">
          <i class="none"></i>
        Sponsoring Apache</a>
            </li>
                
      <li>
  
                          <a href="http://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks">
          <i class="none"></i>
        Thanks</a>
            </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Maven classloading</h1>
<p>![](maven-classloading.png)</p>
<div class="section">
<h2><a name="ClassWorlds_bootstrap_classloader"></a>ClassWorlds bootstrap classloader</h2>
<p>This classloader is created and managed by the calling environment: JVM launcher, integration testing harness, etc.</p>
<p>During normal command line Maven invocation this is the JVM System classloader and contains classes from <tt>${maven.home}/boot/plexus-classworlds-*.jar</tt> and classes from <tt>-javaagent</tt>.</p></div>
<div class="section">
<h2><a name="Maven_Core_classloader"></a>Maven Core classloader</h2>
<p>This classloader contains core Maven runtime classes like MavenProject, AsbtractMojo and so on. This is the classloader set as the &#x201c;container realm&#x201d; in the Plexus container instance unless Maven Extensions classloader is created (see below).</p>
<p>Contents of this classloader are configured in <tt>${maven.home}/bin/m2.conf</tt> and typically contains <tt>${maven.home}/lib/ext/*.jar</tt> and <tt>${maven.home}/lib/*.jar</tt>.</p></div>
<div class="section">
<h2><a name="Maven_Core_Extensions_classloaders"></a>Maven Core Extensions classloaders</h2>
<p>Core Extensions is a new mechanism introduced in Maven 3.3.0 which allows additional components to be loaded into Maven Core as part of a build session.</p>
<p>Each core extension is loaded in a separate classloader and there is no mechanism to share classes among core extensions. Core extensions classloaders use Maven Core classloader as the parent and have access to both exported and internal Maven Core classes.</p>
<p>Core extension can use <tt>META-INF/maven/extension.xml</tt> descriptor to declare packages and artifacts exported by the extension. If the descriptor is not present, no packages or artifacts are exported, but the extension can still contribute components to Maven Core extension points.</p>
<p>Core extensions are configured in <tt>${maven.projectBasedir}/.mvn/extensions.xml</tt> configuration file.</p>

<div class="source">
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;extensions&gt;
  &lt;extension&gt;
    &lt;groupId&gt;...&lt;/groupId&gt;
    &lt;artifactId&gt;...&lt;/artifactId&gt;
    &lt;version&gt;...&lt;/version&gt;
  &lt;/extension&gt;
  &lt;extension&gt;...&lt;/extension&gt;
  ...
&lt;/extensions&gt;
</pre></div></div>
<p>Core extensions are loaded as part of Maven runtime startup and disposed of as part of Maven runtime shutdown.</p></div>
<div class="section">
<h2><a name="Maven_extensions_classloader"></a>Maven extensions classloader</h2>
<p>Maven extensions classloader aggregates packages exported by core extensions realms. It also loads additional classpath entries specified in <tt>-Dmaven.ext.class.path</tt> command line parameter.</p>
<p>Maven extensions classloader is created only when core extensions are configured for the build. If created, it will be set as &#x201c;container realm&#x201d; in the Plexus container. </p></div>
<div class="section">
<h2><a name="Maven_API_classloader"></a>Maven API classloader</h2>
<p>Maven API classloader aggregates exported packages from Maven Core and Maven Core Extensions classloaders. Maven API classloader does not include any classes directly.</p>
<p>Maven API uses approximate JVM Bootstrap classloader as its parent. (there is no API to access JVM Bootstrap classloader, implementation uses <tt>ClassLoader.getSystemClassLoader().getParent()</tt>). The parent classloader does not contain any application or javaagent classes, which allows for consistent Maven API classpath regardless how Maven JVM was launched.</p></div>
<div class="section">
<h2><a name="Build_Extension_classloaders"></a>Build Extension classloaders</h2>
<p>Modern Maven 3.x build extensions are build extensions that either consist of multiple artifacts or have <tt>META-INF/maven/extension.xml</tt>. Each modern build extension is loaded in a a fully isolated classloader, i.e. it is not possible to share classes or inject components among extensions.</p>
<p>Maven guarantees that each distinct modern build extension (as identified by plugin groupId, artifactId, version and set of dependecies) is loaded by one and only one extensions classloader and the classloader is wired to all projects that use the extension.</p>
<p>Build extension classloaders use ClassWorld bootstrap classloader as the parent, which allows build extensions access to <tt>-javaagent</tt> classes.</p></div>
<div class="section">
<h2><a name="Project_classloaders"></a>Project classloaders</h2>
<p>Project classloader aggregates Maven API packages, packages exported by project build extensions. </p>
<p>Project classloaders use Maven API classloader as the parent and import exported classes from project build extension realms. Legacy Maven 2.x build extensions, i.e. extensions that consist of single artifact which does not include <tt>META-INF/maven/extension.xml</tt> descriptor, are directly in project classloaders.</p>
<p>Maven guarantees there will be one and only one project classloader for each unique set of project build extensions and the same classloader will be used by all projects that have the set of build extensions.</p></div>
<div class="section">
<h2><a name="Plugin_classloaders"></a>Plugin classloaders</h2>
<p>Plugin classloaders are wired differently for projects with and without build extensions.</p>
<p>For projects without build extensions, single classloader is created for each plugin identified by groupId:artifactId:version and the classloader imports API packages from Maven API classloader. Maven will create one and only one classloader for each unique plugin+dependency combination.</p>
<p>For projects that use build extensions, plugin classloaders are wired to project classloaders. This gives plugin code access to both Maven API packages and packages exported by the project build extensions. Maven will create one and only one classlaoder for each unique plugin+dependencies+buid-extensions combination.</p>
<p>All plugin classloaders use ClassWorlds bootstrap classloader as the parent. This provides relatively clean and therefore consistent plugin classpath, while still allowing plugins access to <tt>-javaagent</tt> classes (see <a class="externalLink" href="http://jira.codehaus.org/browse/MNG-4747">MNG-4747</a>).</p>
<p>Reporting plugins are wired differently still, but reporting plugins are a special case and are outside of the scope of this document.</p></div>
<div class="section">
<h2><a name="Exported_artifacts_and_packages"></a>Exported artifacts and packages</h2>
<p>Maven Core, Session and Build Extensions use <tt>META-INF/maven/extension.xml</tt> descriptor to declare API packages and artifacts exported by the classloader. </p>

<div class="source">
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;extension&gt;
 &lt;!-- 
   | list of exported classname prefixes.
   --&gt;
 &lt;exportedPackages&gt;
   &lt;exportedPackage&gt;org.something.myextension&lt;/exportedPackage&gt;
 &lt;/exportedPackages&gt;
     
 &lt;!-- 
   | exported artifacts in groupId:artifactId format 
   --&gt;
 &lt;exportedArtifacts&gt;
   &lt;exportedArtifact&gt;org.company:myextension&lt;/exportedArtifact&gt;
 &lt;/exportedArtifacts&gt;
&lt;/extension&gt;
</pre></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2002&#x2013;2015
                        <a href="http://www.apache.org/">The Apache Software Foundation</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
